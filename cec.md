# HDMI CEC协议详解

## 概述

HDMI CEC（Consumer Electronics Control）协议是一种允许通过HDMI线缆进行设备控制的通信协议。它主要用于家庭娱乐系统中，使得用户可以通过单一遥控器来控制多个连接到同一台电视或其他显示设备的电子设备。这种协议支持的功能包括：

- **设备唤醒与待机**：例如，当用户按下DVD播放机上的电源按钮时，电视也会从待机状态唤醒。
- **源切换**：用户可以通过按遥控器上的特定键在不同的输入源之间切换。
- **音量控制**：用户可以在任何连接的设备上调整音量，而不需要直接操作接收音频信号的设备。
- **信息传递**：CEC可以用于发送各种命令和报告状态信息，比如当前播放的内容类型、图像分辨率等。

## 数据帧结构

每个CEC消息都是以帧的形式传输的，这些帧由一系列字节组成。一个典型的CEC帧包含以下字段：

1. **起始位（Start Bit）**：表示帧的开始。
2. **逻辑地址（Logical Address）**：指示消息的目标设备。共有15个可用的逻辑地址，分别对应不同的设备类型，例如电视（0x00）、录音机/录像机（0x01）等。
3. **命令码（Opcode）**：指定要执行的操作。命令码定义了多种功能，如`Active Source`、`Image View On`、`Text View On`、`Standby`等。
4. **参数（Operands）**：某些命令需要额外的数据来完成操作，这些数据被称为参数。
5. **结束位（Stop Bit）**：表示帧的结束。

### 帧格式示例

假设我们有一个简单的CEC帧，其目标是将电视设置为活动源。这个帧可能看起来像这样：
```
[起始位][电视的逻辑地址（0x00）][命令码（Active Source，0x82）][物理地址（高字节）][物理地址（低字节）][结束位]
```

在这个例子中：
- 起始位标志着帧的开始。
- `0x00` 是电视的逻辑地址。
- `0x82` 是 `Active Source` 命令的命令码。
- 物理地址是由两个字节组成的唯一标识符，用于区分网络中的不同设备。
- 结束位标志着帧的结束。

## 物理地址

物理地址是一个两字节的值，用于在网络中唯一地识别每个设备。它的结构如下：
```
[设备树深度][分支号][设备编号]
```

- **设备树深度**：表示设备在网络中的层级位置。根设备（通常是电视）的深度为0。
- **分支号**：表示设备在其父设备下的分支位置。
- **设备编号**：表示设备在其分支中的具体位置。

例如，如果一个AV放大器连接到电视的一个端口，其物理地址可能是 `0F:00`，其中 `0F` 表示它是电视的一个子设备，而 `00` 表示它是该分支的第一个设备。

## 命令集

CEC协议定义了一系列的标准命令，这些命令涵盖了几乎所有的基本操作。下面是一些常见的命令及其作用：

- **`Active Source` (0x82)**：宣布自己为当前活动源。
- **`Image View On` (0x04)**：请求设备打开图像视图。
- **`TextViewOn` (0x0D)**：请求设备打开文本视图。
- **`Standby` (0x36)**：通知设备进入待机模式。
- **`Report Physical Address` (0x84)**：要求设备报告其物理地址。
- **`Get Device Info` (0x94)**：请求获取设备的信息。
- **`Set OSD String` (0x67)**：在设备屏幕上显示字符串。
- **`Vendor Command With ID` (0x8F)**：用于厂商特定的消息。

## 实际应用

为了更好地理解CEC的实际应用，我们可以考虑一个简单的场景：当你按下蓝光播放机上的“Source”按钮时，会发生什么？

1. **发现活动源**：蓝光播放机首先会广播 `Request Active Source` 命令，询问谁是当前的活动源。
2. **响应活动源**：电视收到命令后，会回应 `Active Source` 命令，并附带自己的物理地址。
3. **切换源**：蓝光播放机接收到响应后，知道电视是当前的活动源，然后向电视发送 `Inactive Source` 命令，告诉电视它不再是活动源。
4. **成为活动源**：随后，蓝光播放机会向电视发送 `Active Source` 命令，宣布自己成为了新的活动源。
5. **图像显示**：最后，蓝光播放机会向电视发送 `Image View On` 命令，请求电视打开图像视图，以便显示播放的内容。

## 总结

HDMI CEC协议提供了一种简单且有效的方法，用于管理和控制家庭娱乐系统中的各个设备。通过理解和利用CEC协议，用户可以更方便地操作他们的设备，提升整体的用户体验。希望上述内容能帮助你更好地了解HDMI CEC协议及其工作原理。

如果你有更多具体的问题或需要进一步的技术细节，请随时提问！